(function(e,t){function H(n){s=e("<div>").addClass("pbThumbs");y&&s.css("overflow","auto");var r=e("<ul>").appendTo(s),i;n.each(function(){i=t.createElement("a");i.href=this.href;i.appendChild(e(this.children[0]).clone()[0]);e("<li>").append(i).appendTo(r)});s.appendTo(_);e(k).addClass("thumbs");s.on("click","a",B).data("a",s.find("a"))}function B(t){t.preventDefault();S.removeClass("active");S=e(this).parent().addClass("active");var n=e.inArray(this,e(t.delegateTarget).data("a"));return z(n,0,1)}function j(e){var n,r=t.body.style,i=["ms","O","Moz","Webkit"];if(r[e]=="")return e;e=e[0].toUpperCase()+e.slice(1);for(n=i.length;n--;)if(r[i[n]+e]=="")return i[n]+e}function F(n){if(n)A.src=x;e(A).css({transition:"0s"}).removeAttr("style");e(k).show().addClass("show");e(k).on("click","img",function(e){e.stopPropagation()});e(k).on(v,function(){e(A).addClass("zoomable");e(k).off(v).addClass("on")});if(m)e(k).trigger("MSTransitionEnd");if(r.hideFlash){e.each(["object","embed"],function(t,r){e(r).each(function(){if(n)this._picbox=this.style.visibility;this.style.visibility=n?"hidden":this._picbox})})}var i=n?"on":"off";e(t)[i]({"keydown.photobox":R,"mousewheel.photobox":$})}function I(){w=s[0].clientWidth;E=s[0].firstChild.clientWidth;var e=E>w?"on":"off";!y&&s[e]("mousemove",q)}function q(e){var t=E/w;s[0].scrollLeft=e.pageX*t-500}function R(e){var t=e.keyCode,n=r.keys,i;return n.close.indexOf(t)>=0&&Q()||n.next.indexOf(t)>=0&&U("next")||n.prev.indexOf(t)>=0&&U("prev")||true}function U(t){if(e(pbOverlay).hasClass("hide"))return false;var n=this.id=="pbPrevBtn"||t=="prev"?f:l;return z(n,0)}function z(t,n){if(t>=0){u=t;a=i[t][0];f=(u||(r.loop?i.length:0))-1;l=(u+1)%i.length||(r.loop?0:-1);K();e(k).addClass("pbLoading").removeClass("error");!r.loop&&t==i.length-1?M.addClass("hide"):M.removeClass("hide");!r.loop&&t==0?O.addClass("hide"):O.removeClass("hide");if(f>=0)N.src=i[f][0];if(l>=0)C.src=i[l][0];r.counter&&_.find(".counter").text("( "+(u+1)+" / "+i.length+" )");r.title&&_.find(".title").text(i[t][1]);e(A).siblings().hide();T=new Image;T.onload=function(){V(n)};T.onerror=function(){X()};T.src=a}return false}function W(e,t,n){S.removeClass("active");S=s.find("li").eq(e).addClass("active");if(n)return;var r=S[0].offsetLeft+S[0].clientWidth/2-p.clientWidth/2;t&&s.delay(800);!t&&s.stop();s.animate({scrollLeft:r},500,"swing")}function X(){e(k).removeClass("pbLoading").addClass("error");A.src=x;T.onerror=null}function V(t){function n(){e(A).css({transition:"0s"}).attr("class","prepare").hide().off(v);e(k).removeClass("hide");A.src=a;setTimeout(function(){e(A).removeAttr("style");setTimeout(function(){A.className=""},0)},0)}if(!t){e(k).addClass("hide");e(A).on(v,n);if(e(A).css("opacity")=="0")n()}else n();e(k).removeClass("pbLoading")}function $(n,r){var i=e(A).data("zoom")||1,s=A.getBoundingClientRect();i=i+r/10;if(i<.1)i=.1;e(A).data("zoom",i).css({transform:"scale("+i+")"});if(s.height>p.clientHeight||s.width>p.clientWidth)e(t).on("mousemove.photobox",J);else{e(t).off("mousemove.photobox");A.style[b]="50% 50%"}return false}function J(e){var t=e.clientY/p.clientHeight*(p.clientHeight+200)-100,n=t/p.clientHeight*100,r=e.clientX/p.clientWidth*100,i=r.toFixed(2)+"% "+n.toFixed(2)+"%";A.style[b]=i}function K(){T.onload=function(){};T.src=N.src=C.src=a}function Q(){function t(){e(k).removeClass("show hide on");e(A).removeAttr("class").removeAttr("src").removeAttr("style").off().data("zoom",1);if(g)setTimeout(function(){e(k).hide()},200)}K();u=f=l=-1;e(document).off("mousemove");F();e(k).addClass("hide");e(A).on(v,t);m&&t();setTimeout(t,500);return false}function Z(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=true,o=0,u=0;t=e.event.fix(n);t.type="mousewheel";if(n.wheelDelta){i=n.wheelDelta/120}if(n.detail){i=-n.detail/3}u=i;if(n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS){u=0;o=-1*i}if(n.wheelDeltaY!==undefined){u=n.wheelDeltaY/120}if(n.wheelDeltaX!==undefined){o=-1*n.wheelDeltaX/120}r.unshift(t,i,o,u);return(e.event.dispatch||e.event.handle).apply(this,r)}var n=e(window),r,i=[],s,o,u=-1,a,f,l,c,h,p,d="",v="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",m=!("placeholder"in document.createElement("input")),g=!!window.ActiveXObject,y="ontouchend"in document,b,w,E,S=e(),x="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",T={},N=new Image,C=new Image,k,L,A,O,M,_,D,P={loop:true,thumbs:true,counter:false,title:false,hideFlash:true,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}};e(t).ready(function(){e(t.body).prepend(e([k=e('<div id="pbOverlay">').hide().on("click",Q).append(D=e('<div class="pbLoader"><b></b><b></b><b></b></div>'),O=e('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",U),M=e('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",U),imageWrap=e('<div class="imageWrap">').append(A=e("<img>")[0])[0],L=e('<div id="pbCloseBtn">').append("<b>X</b>").on("click",Q)[0],_=e('<div id="pbCaption">').append('<div class="title">').append('<div class="counter">'))[0]]));b=j("transformOrigin")});e.photobox=function(t,n){r=e.extend(P,n||{});m&&e(k).addClass("msie");F(1);if(i.length<2)_.find(".counter").remove();return z(t,true)};e.fn.photobox=function(n,r){function s(r){r.preventDefault();if(i.length<2)O.add(M).remove();p=t.documentElement;return e.photobox(e.inArray(this,o),n)}o=this;o=o.filter(function(e){var t=this,n=t.firstElementChild||this.children[0];if(!n||!n.tagName||n.tagName.toLowerCase()!="img")return false;i.push([t.href,n.getAttribute("alt")||n.getAttribute("title")]);return true});e(this.context).on("click",this.selector,s);return this};var G=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks){for(var Y=G.length;Y;)e.event.fixHooks[G[--Y]]=e.event.mouseHooks}e.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=G.length;e;)this.addEventListener(G[--e],Z,false)}else this.onmousewheel=Z},teardown:function(){if(this.removeEventListener){for(var e=G.length;e;)this.removeEventListener(G[--e],Z,false)}else this.onmousewheel=null}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(jQuery,document)